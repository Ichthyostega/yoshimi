#!/bin/sh
set -e

infile="$1"

if [ ! -f "${infile}" ]; then
	infile=${0%/*}/${infile}
fi
if [ ! -f "${infile}" ]; then
	echo "usage: $0 <yoshimifile>" 1>&2
	exit 1
fi
cat "${infile}" | yoshimi --null --no-gui --cmdline

md5file=${infile%.yosh}.md5
if [ -f "${md5file}" ]; then
	## ideally we hash-compare the generated files with our reference
	# md5sum -c "${md5file}"

	## unfortunately, yoshimi's output seems to be unstable (thus not comparable)
	md5sum $(cat "${md5file}" | sed -e 's|^[^[:space:]]*[[:space:]]*||')
fi
